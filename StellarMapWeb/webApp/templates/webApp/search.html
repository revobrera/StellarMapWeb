{% load static %}

<!DOCTYPE html>
<html>
<head>
  <title>StellarMap Web</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- include custom theme -->
  <link rel="stylesheet" type="text/css" href="{% static 'webApp/frontend.css' %}">
  <!-- include the Font Awesome library for the search icon -->
  <link rel="stylesheet" type="text/css" href="{% static 'font-awesome-6.2.1/css/all.min.css' %}">
</head>
<body class="bg-color-261D45">
  <div id="app">
    <div class="top-container">
      <!-- using the verbatim tag to avoid conflicts between Django and Vue.js templates -->
      {% verbatim %}
        <div class="search-container">
          <!-- keeps the elements on the same line and responsive -->
          <div class="container-fluid">
            <div class="row align-items-center">
              <div class="col-auto">
                <b-button class="sidebar-button" v-b-toggle href="#sidebar-menu" @click.prevent><i class="fa fa-bars"></i></b-button>
              </div>
              <div class="col">
                <div class="row align-items-center">
                  <b-form-checkbox 
                    v-model="network_toggle" 
                    switch 
                    @change="toggleNetwork"
                    :class="{ 'text-red': !network_toggle, 'text-green': network_toggle }"
                  >{{network_selected}}</b-form-checkbox>
                  <input type="text" v-model="query_account" @keyup.enter="search" placeholder="Paste a Stellar account address...">
                </div>
              </div>
              <div class="col-auto">
                <button @click="search"><i class="fa fa-space-shuttle"></i></button>
              </div>
            </div>
          </div>
        </div>
        {% endverbatim %}
    </div>
    <div class="results-container">
        <div class="response-container">
            <div type="text" v-text="response"></div>
        </div>
    </div>
    
    <b-sidebar id="sidebar-menu" title="StellarMap.Network" shadow>
      <div class="px-3 py-2">
        This web application allows users to generate the lineage of Stellar addresses 
        and visualize them in a radial, tidy tree format. The tree maps address types 
        and activity, providing a clear and organized view of the relationships between addresses. 
      </div>

      <template #footer="{ hide }">
        <div class="d-flex text-light align-items-center px-3 py-2">
        <b-button class="close-button" @click="hide">
          <i class="fas fa-sign-out icon-pad"></i> Close
        </b-button>

        </div>
      </template>
   
    </b-sidebar>
  </div>
  <!-- Load required Bootstrap and BootstrapVue CSS -->
  <link rel="stylesheet" type="text/css" href="{% static 'bootstrap-4.6.2/css/bootstrap.min.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'bootstrap-vue-2.23.1/bootstrap-vue.min.css' %}">

  <!-- Load Vue followed by BootstrapVue -->
  <script src="{% static 'vue-2.6.12/vue.js' %}"></script>
  <script src="{% static 'bootstrap-vue-2.23.1/bootstrap-vue.min.js' %}" crossorigin="anonymous"></script>
  <script>
    new Vue({
      el: '#app',
      data: {
        query_account: '',
        loading: false,
        response: '',
        network_toggle: false,
        network_selected: 'testnet'
      },
      methods: {
        async search() {
          // Set 'loading' to true to show a loading indicator
          this.loading = true;
          try {
            // Fetch data from either the testnet or public Horizon server depending on the value of 'network_selected'
            const response = await fetch(
              this.network_selected === 'testnet'
                ? `https://horizon-testnet.stellar.org/accounts/${this.query_account}`
                : `https://horizon.stellar.org/accounts/${this.query_account}`
            );
            // Store the response text in 'response'
            this.response = await response.text();
            // Set 'loading' to false to hide the loading indicator
            this.loading = false;
          } catch (e) {
            // If an error occurs, store the error message in 'response'
            this.response = e.message;
          }
        },
        toggleNetwork() {
          // Method that toggles the value of 'network_selected' between 'testnet' and 'public'
          this.network_selected = this.network_toggle ? 'public' : 'testnet'
        }
      }
    })
  </script>
</body>
</html>
